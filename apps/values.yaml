# This file configures an ArgoCD app of apps that represent a beamline or
# group of accelerator IOCs and services. The details of the services are
# configured in the separate repo indicated by repoURL.

# This repostory only controls which services and which versions of those
# services should be running on the cluster. It is recommended that this repo
# be updated by a CI/CD pipeline or configuration tools only.

# For live start/stop of services use the argocd CLI to override the enabled
# parameter or removed parameter in the services dictionary below.

# The apps that deploy each service are created via the .argocd directory in
# the source repo. .argocd is a helm chart that creates an ArgoCD app for each
# service listed in the services dictionary below. Each service is itself a
# helm chart that is sourced from the services/<service> directory in the
# source repo.

project: bl45p

appDestination:
  name: argus
  namespace: bl45p

serviceDestination:
  name: pollux
  namespace: bl45p

source:
  # These defaults are used to fetch the .argocd directory which creates the
  # service apps. They are also defaults for the service apps themselves. But
  # each service can override these defaults.
  repoURL: https://github.com/epics-containers/bl45p.git
  targetRevision: add-extra-app-layer

# dictionary of services to deploy. Each item is of the form:
# service: service name as it appears in K8S (statefulset/deployment name)
#   targetRevision: optional override for targetRevision above
#   repoURL: optional override for git repo to source the helm chart from
#            the path is always services/<service> within that repo
#   enabled: set to false to turn off an IOC (participating services only)
#   removed: set to true to remove the app from the app of apps

services:
  # shared epics services ######################################################
  epics-pvcs:
  epics-opis:

  # daq services ###############################################################
  daq-rabbitmq:
    # this service always restarts if you don't pin it (must have a random seed)
    targetRevision: 2024.7.6
  daq-blueapi:
  daq-nexus:

  # epics iocs #################################################################

  bl45p-ea-dcam-01:
    enabled: false
  bl45p-ea-dcam-02:
  bl45p-mo-panda-01:
  bl45p-mo-panda-02:
  bl45p-mo-brick-01:
